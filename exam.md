[TOC]

# 笔试

## FPGA开发流程

RTL代码的编写

功能仿真

综合

逻辑块映射

布局和布线

板级验证与仿真

## 同步逻辑和异步逻辑

同步逻辑是时钟之间有固定的因果关系。异步逻辑是各时钟之间没有固定的因果关系。

 同步时序逻辑电路的特点：*各触发器的时钟端全部连接在一起，并接在系统时钟端，只有当时钟脉冲到来时，电路的状态才能改变。*改变后的状态将一直保持到下一个时钟脉冲的到来，此时无论外部输入x有无变化，状态表中的每个状态都是稳定的。

 异步时序逻辑电路的特点：*电路中除可以使用带时钟的触发器外，还可以使用不带时钟的触发器和延迟元件作为存储元件，电路中没有统一的时钟，电路状态的改变由外部输入的变化直接引起。*

## 同步电路和异步电路

同步电路：存储电路中所有触发器的时钟输入端都接同一个时钟脉冲源，因而所有触发器的状态的变化都与所加的时钟脉冲信号同步。

 异步电路：电路没有统一的时钟，有些触发器的时钟输入端与时钟脉冲源相连，只有这些触发器的状态变化与时钟脉冲同步，而其他的触发器的状态变化不与时钟脉冲同步。

## FPGA内部结构及资源

FPGA主要由可编程单元、可编程I/O单元及布线资源构成。

　　可编程逻辑单元（Configurable Logic Block，CLB）由两个SLICE构成，SLICE主要包括实现组合逻辑的LUT和实现时序逻辑的触发器。FPGA内部还包含专用存储单元BRAM，运算单元DSP Slice，及专用内嵌功能单元，如：PLL、Serdes等。

## 功耗

动态功耗是指对器件中的容性负载进行充放电所需的功耗。它很大程度上取决于频率、电压和负载。这三个变量中的每一个都能由你以某种形式进行控制。

静态功耗是指由器件中所有晶体管的泄漏电流(源极到漏极以及栅极泄漏，常常集中为静止电流)所引起的功耗之和，以及任何其他恒定的功耗需求。泄漏电流在很大程度上取决于结温和晶体管尺寸。

## 低功耗

功耗可用公式描述：Power = KFCV^2，即功率等于常数系数\*工作频率\*负载电容值\*电压的平方。

　　故从以下几个方面降低功耗方式：

　　a.控制工作频率：降低频率增大数据路径宽度，动态频率调整，门控时钟（时钟使能有效时钟才进入寄存器时钟输入引脚）

　　b.减少电容负载：使用几何尺寸更小的逻辑门，其电容负载较小，功率也随之减少。

　　c.降低工作电压：动态改变工作电压、零操作电压（直接关闭系统中一部分的电源）。

## SRAM和DRAM的区别

SRAM是静态随机访问存储器，由晶体管存储数据，无需刷新，读写速度快。DRAM是动态随机访问存储器，由电容存储数据，由于电容漏电需要动态刷新，电容充放电导致读写速度较SRAM低。但DRAM成本较低，适合做大容量片外缓存。

## 逻辑设计中竞争与冒险概念，如何识别和消除？

竞争：在组合逻辑电路中，信号经过多条路径到达输出端，每条路径经过的逻辑门不同存在时差，在信号变化的瞬间存在先后顺序。这种现象叫竞争。

冒险：由于竞争而引起电路输出信号中出现了非预期信号，产生瞬间错误的现象称为冒险。表现为输出端出现了原设计中没有的窄脉冲，即毛刺。

常见的逻辑代数法判断是否有竞争冒险存在：只要输出逻辑表达式中含有某个信号的原变量A和反变量/A之间的“与”或者“或”关系，且A和/A经过不同的传播路径，则存在竞争。解决办法一是修改逻辑表达式避免以上情况，二是采样时序逻辑，仅在时钟边沿采样，三是在芯片外部并联电容消除窄脉冲。

判断方法：代数法（如果布尔式中有相反的信号则可能产生竞争和冒险现象）；卡诺图：有两个相切的卡诺圈并且相切处没有被其他卡诺圈包围，就有可能出现竞争冒险；实验法：示波器观测；

## 亚稳态

触发器在规定时间内无法达到一个可确定的状态。时序设计中，触发器的输入信号违反时序要求，在建立时间与保持时间之内发生输入变化。

1. 一个周期内振荡稳定，最后输出一个稳定值，但不一定输出正确的传输信号；

2. 输出在一个周期内不能稳定，将亚稳态传播给下一级触发器（危害极大）；

   假设第一级触发器的输入不满足其建立 保持时间，它在第一个脉冲沿到来后输出的数据就为亚稳态，那么在下一个脉冲沿到来 之前，其输出的亚稳态数据在一段恢复时间后必须稳定下来，而且稳定的数据必须满足 第二级触发器的建立时间，如果都满足了，在下一个脉冲沿到来时，第二级触发器将不 会出现亚稳态，因为其输入端的数据满足其建立保持时间。同步器有效的条件：第一级 触发器进入亚稳态后的恢复时间 + 第二级触发器的建立时间 < = 时钟周期。更确切地 说，输入脉冲宽度必须大于同步时钟周期与第一级触发器所需的保持时间之和。最保险 的脉冲宽度是两倍同步时钟周期。 所以，这样的同步电路对于从较慢的时钟域来的异 步信号进入较快的时钟域比较有效，对于进入一个较慢的时钟域，则没有作用 。

## 寄存器 锁存器

1. 锁存器（latch）---对脉冲电平敏感，在时钟脉冲的电平作用下改变状态 ；锁存器在组合逻辑中if没写完else或者case没写default产生。
2. 触发器（Flip-Flop，简写为 FF）---对脉冲边沿敏感，其状态只在时钟脉冲的上升沿或下降沿的瞬间改变 ；

## 阻塞和非阻塞

1. 阻塞赋值，例如 a=b; 当这个赋值语句执行的时候是不允许有其它语句执行的，这就是阻塞的原因。
2. 非阻塞赋值，例如a<=b;当这个赋值语句执行的时候是不阻碍其它语句执行的。

## 状态机

### 类别

1. Mealy状态机：时序逻辑的输出不但取决于状态还取决于输入。
2. Moore状态机：时序逻辑的输出仅取决于状态。

### 三段式

1. 时序逻辑，次状态到现状态；
2. 组合逻辑，case(现状态)，转移next；
3. 时序逻辑，next的输出；

## FIFO

写时钟频率w_clk,
读时钟频率 r_clk,
写时钟周期里，每B个时钟周期会有A个数据写入FIFO
读时钟周期里，每Y个时钟周期会有X个数据读出FIFO
则，FIFO的最小深度是？

深度计算： fifo_depth = burst -burst\* (X/Y) \*(r_clk/w_clk)

## sdc

### 建立时间

 在clk上升沿到来之前，数据提前一个最小时间量“预先准备好”，这个最小时间量就是建立时间

### 保持时间

在clk上升沿来之后，数据必须保持一个最小时间量“不能变化”，这个最小时间量就是保持时间。

## 速度和面积优化

### 资源优化

1. 资源共享

   资源共享主要针对数据通路中耗费逻辑资源较多的模块，通过选择、复用的方式共享使用该模块，达到减少资源使用、优化面积的目的。

2. 逻辑优化

   使用优化后的逻辑进行设计，可以明显减少资源的占用。

   * 状态机的设计要尽可能简洁，不要搞出不必要的，多个状态对同一个数据做处理。
   * if语句中用单bit的标志位代替多bit的数据来进行条件判断。
   * 设计尽可能简洁，不要弄出冗余赋值。

3. 串行化

### 速度优化

1. 流水线设计

   流水线(Pipelining)是一种在复杂组合逻辑之间添加寄存器的方法，是最常用的速度优化技术之一。它能显著地提高设计电路的运行速度上限。

2. 寄存器配平 

   寄存器配平是使较长路径缩短，较短路径加长，使其达到平衡从而提高工作频率的一种技术。

3. 关键路径法

   指设计中从输入到输出经过的延时最长的逻辑路径。

4. 乒乓操作法

   乒乓操作法是FPGA开发中的一种数据缓冲优化设计技术，可视作另一种形式的流水线技术。

5. 树形结构法

## 时序约束的概念和基本策略

​		时序约束主要包括周期约束，偏移约束，静态时序路径约束三种。通过附加时序约束可以综合布线工具调整映射和布局布线，使设计达到时序要求。

​		附加时序约束的一般策略是先附加全局约束，然后对快速和慢速例外路径附加专门约束。附加全局约束时，首先定义设计的所有时钟，对各时钟域内的同步元件进行分组，对分组附加周期约束，然后对FPGA/CPLD输入输出PAD附加偏移约束、对全组合逻辑的PAD TO PAD路径附加约束。附加专门约束时，首先约束分组之间的路径，然后约束快、慢速例外路径和多周期路径，以及其他特殊路径。

## 多位的异步信号如何进行同步

对以一位的异步信号可以使用“一位同步器进行同步”（使用两级触发器）。

而对于多位的异步信号，可以采用如下方法：

1. 可以采用保持寄存器加握手信号的方法（多数据，控制，地址）；
2. 特殊的具体应用电路结构,根据应用的不同而不同；
3. 异步FIFO。（最常用的缓存单元是DPRAM）

## FPGA芯片内有哪两种存储器资源

FPGA芯片内有两种存储器资源：一种叫BLOCK RAM,另一种是由LUT配置成的内部存储器（也就是分布式RAM）。BLOCK RAM由一定数量固定大小的存储块构成的，使用BLOCK RAM资源不占用额外的逻辑资源，并且速度快。但是使用的时候消耗的BLOCK RAM资源是其块大小的整数倍。

## 时钟抖动

时钟抖动是指芯片的某一个给定点上时钟周期发生暂时性变化，也就是说时钟周期在不同的周期上可能加长或缩短。它是一个平均值为0的平均变量。

## 常用约束

1. set_property PACKAGE_PIN H16 [get_ports sysclk]
   set_property IOSTANDARD LVCMOS33 [get_ports sysclk]
2. create_clock -name sysclk -period 8.000 -waveform {0.000 4.000} [get_ports sysclk]

## do文件

1. 退出仿真`quit -sim`
2. 新建一个work库 `vlib`
3. 将目前的逻辑工作库work和实际工作库work映射对应`vlog`
4. 仿真`vsim`
5. 添加信号`add wave -color -radix `
6. 运行`run -all`

## 其他

ROM：**R**ead **O**nly **M**emory，只读存储器，手机、计算机等设备的存储器，但现在的所说的ROM不只是Read Only了，也是可以写入的。

RAM：**R**andom **A**ccess **M**emory，随机存取存储器，手机、计算机的运行内存。

SRAM：**S**tatic **R**andom-**A**ccess **M**emory，静态随机存取存储器，只要供电数据就会保持，但断电数据就会消失，也被称为Volatile Memory

DRAM：**D**ynamic **R**andom **A**ccess **M**emory，动态随机存储器，主要原理是利用电容存储电荷的多少来代表一个bit是0还是1，由于晶体管的漏电电流现象，电容会放电，所以要周期性的给电容充电，叫刷新。SRAM不需要刷新也会保持数据丢失，但是两者断电后数据都会消失，称为Volatile Memory

SDRAM：**S**ynchronous **D**ynamic **R**andom **A**ccess **M**emory，同步动态随机存储器，同步写入和读出数据的DRAM。

EEPROM：**E**lectrically **E**rasable **P**rogrammable **R**ead **O**nly **M**emory，电可擦除可编程只读存储器，

DDR：**D**ouble **D**ata **S**ynchronous **D**ynamic **R**andom **A**ccess **M**emory，双倍速率同步动态随机存储器，双倍速率传输的SDRAM，在时钟的上升沿和下降沿都可以进行数据传输。我们电脑的内存条都是DDR芯片。

FLASH： Flash Memory，闪存，非易失性固态存储，如制成内存卡或U盘。